#!/usr/bin/env bash
set -euo pipefail

GRADLE="./gradlew"; [ -x "$GRADLE" ] || GRADLE="gradle"
echo "ğŸ” Pre-commit checks"

# Java ë³€ê²½ ì—†ìœ¼ë©´ ìŠ¤í‚µ(ì›í•˜ë©´ ì œê±°)
if ! git diff --cached --name-only | grep -E '^src/.*\.java$' >/dev/null 2>&1; then
  echo "â„¹ï¸ Staged Java ë³€ê²½ ì—†ìŒ â†’ ìŠ¤í‚µ"; exit 0; fi

# í¬ë§· ì²´í¬ â†’ ìë™ìˆ˜ì • í›„ ì»¤ë°‹ ì¤‘ë‹¨
if ! $GRADLE -q spotlessCheck; then
  echo "ğŸ§¹ Formatting issues â†’ spotlessApply"
  $GRADLE -q spotlessApply
  git add -A
  echo "â— í¬ë§· ìë™ ìˆ˜ì •ë¨. ë³€ê²½ í™•ì¸ í›„ ë‹¤ì‹œ ì»¤ë°‹í•˜ì„¸ìš”."
  exit 1
fi

# ì •ì  ë¶„ì„ + í…ŒìŠ¤íŠ¸
$GRADLE -q preCommit
echo "âœ… OK"