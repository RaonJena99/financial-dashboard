#!/usr/bin/env bash
set -euo pipefail

GRADLE="./gradlew"; [ -x "$GRADLE" ] || GRADLE="gradle"
echo "π” μ»¤λ°‹ μ „ μ κ²€μ„ μ‹μ‘ν•©λ‹λ‹¤."

# Java λ³€κ²½ μ—†μΌλ©΄ μ¤ν‚µ
if ! git diff --cached --name-only | grep -E '^src/.*\.java$' >/dev/null 2>&1; then
  echo "β„ΉοΈ μ¤ν…μ΄μ§•λ Java νμΌ λ³€κ²½μ΄ μ—†μµλ‹λ‹¤. μ κ²€μ„ κ±΄λ„λλ‹λ‹¤.";
  exit 0;
fi

# ν¬λ§· μ²΄ν¬ β†’ μλ™μμ • ν›„ μ»¤λ°‹ μ¤‘λ‹¨
if ! $GRADLE -q spotlessCheck; then
  echo "π§Ή μ½”λ“ ν¬λ§· λ¶μΌμΉ λ°κ²¬ β†’ μλ™ μ •λ ¬ μ¤‘..."
  $GRADLE -q spotlessApply
  git add -A
  echo "β— μ½”λ“ μ¤νƒ€μΌμ΄ μλ™μΌλ΅ μμ •λμ—μµλ‹λ‹¤."
  echo "π‘‰ λ³€κ²½ λ‚΄μ©μ„ ν™•μΈν• λ’¤ λ‹¤μ‹ μ»¤λ°‹ν•΄μ£Όμ„Έμ”."
  exit 1
fi

# μ •μ  λ¶„μ„ + ν…μ¤νΈ
echo "π§ μ •μ  λ¶„μ„ λ° ν…μ¤νΈλ¥Ό μ‹¤ν–‰ν•©λ‹λ‹¤..."
$GRADLE -q preCommit

echo "β… λ¨λ“  κ²€μ‚¬λ¥Ό ν†µκ³Όν–μµλ‹λ‹¤. μ»¤λ°‹μ„ μ§„ν–‰ν•©λ‹λ‹¤!"